name: push-guard

on:
  push:
    branches: [ main ]

jobs:
  guard:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const allowed = ['rostialpin','rob1nalex'];
            const actor = context.actor;
            if (!allowed.includes(actor)) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `Direct push to main by @${actor}`,
                body: `A direct push to main occurred by @${actor}. Per team policy, pushes to main must go through PR and owner approval. Please open a PR next time.`,
                labels: ['policy-violation']
              });
              core.setFailed(`Direct push to main by @${actor} (policy violation).`);
            } else {
              core.info('Owner push to main allowed.');
            }

